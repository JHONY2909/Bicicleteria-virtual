{% extends 'base.html' %}
{% block title %}Detalles del Pedido #{{ pedido.id }} - BikeShop{% endblock %}
{% block content %}

<div class="form-container">
    <div class="form-header">
        <h2 class="form-title">Detalles del Pedido #{{ pedido.id }}</h2>
        <p class="form-subtitle">Fecha: {{ pedido.fecha_creacion.strftime('%d/%m/%Y') }}</p>
    </div>

    <div class="cart-table">
        <div class="cart-table-header">
            <div class="cart-table-header-row">
                <span>Producto</span>
                <span>Cantidad</span>
                <span>Subtotal</span>
            </div>
        </div>
        
        {% if pedido.detalles %}
            {% for detalle in pedido.detalles %}
                <div class="cart-item">
                    <div class="cart-item-row">
                        <div class="cart-item-product">
                            {% if detalle.producto.url_imagen %}
                                <img src="{{ detalle.producto.url_imagen }}" alt="{{ detalle.producto.nombre }}" class="cart-item-image">
                            {% else %}
                                <img src="{{ url_for('static', filename='images/placeholder.jpg') }}" alt="Placeholder" class="cart-item-image">
                            {% endif %}
                            <div class="cart-item-info">
                                <h4>{{ detalle.producto.nombre }}</h4>
                            </div>
                        </div>
                        <div>{{ detalle.cantidad }}</div>
                        <div>${{ "%.2f"|format(detalle.precio_unitario * detalle.cantidad) }}</div>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="empty-cart">
                <i class="fas fa-exclamation-circle empty-cart-icon"></i>
                <h3>No hay detalles disponibles</h3>
            </div>
        {% endif %}
    </div>

    <div class="cart-table">
        <div class="cart-table-header">
            <h3>Información del Pedido</h3>
        </div>
        <div class="cart-item">
            <p><strong>Estado:</strong> {{ pedido.estado|title }}</p>
            <p><strong>Método de Pago:</strong> {{ pedido.metodo_pago|title }}</p>
            <p><strong>Monto Total:</strong> ${{ "%.2f"|format(pedido.monto_total) }}</p>
            {% if pedido.direccion %}
                <p><strong>Dirección de Envío:</strong> {{ pedido.direccion.calle }}, {{ pedido.direccion.ciudad }} {% if pedido.direccion.codigo_postal %}({{ pedido.direccion.codigo_postal }}){% endif %}</p>
            {% else %}
                <p><strong>Dirección de Envío:</strong> No disponible</p>
            {% endif %}
        </div>
    </div>

    {% if pedido.estado == 'pagado' %}
        <div class="cart-actions">
            <a href="{{ url_for('cart.descargar_factura', pedido_id=pedido.id) }}" class="btn btn-primary checkout-btn">Descargar Factura</a>
            <a href="{{ url_for('dashboard.mis_pedidos') }}" class="continue-shopping">Volver a Mis Pedidos</a>
        </div>
    {% else %}
        <div class="cart-actions">
            <a href="{{ url_for('dashboard.mis_pedidos') }}" class="continue-shopping">Volver a Mis Pedidos</a>
        </div>
    {% endif %}
</div>

{% endblock %}